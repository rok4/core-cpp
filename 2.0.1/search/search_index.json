{"config":{"lang":["fr"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Librairies ROK4 C++","text":"<p>Ces librairies facilitent la manipulation d'entit\u00e9s du projet ROK4 comme les Tile Matrix Sets ou les pyramides, mais aussi la manipulation des donn\u00e9es : lecture et \u00e9criture des dalles, r\u00e9echantillonnage et reprojection de donn\u00e9es raster. 4 types de stockages sont g\u00e9r\u00e9s : fichier, S3, Swift et optionnellement Ceph.</p>"},{"location":"#installer-la-librairie-debian","title":"Installer la librairie (Debian)","text":"<p>Installations syst\u00e8me requises (list\u00e9es dans le paquet debian, install\u00e9es avec la librairie lors du <code>apt install</code>) :</p> <ul> <li><code>zlib1g-dev</code></li> <li><code>libcurl4-openssl-dev</code></li> <li><code>libproj-dev</code></li> <li><code>libssl-dev</code></li> <li><code>libturbojpeg0-dev</code></li> <li><code>libjpeg-dev</code></li> <li><code>libc6-dev</code></li> <li><code>libboost-log-dev</code></li> <li><code>libboost-filesystem-dev</code></li> <li><code>libboost-system-dev</code></li> <li><code>libsqlite3-dev</code></li> <li><code>libpng-dev</code></li> <li><code>libtiff5-dev</code></li> <li><code>libopenjp2-7-dev</code></li> <li><code>librados-dev</code> (uniquement dans le cas d'une installation int\u00e9grant le stockage Ceph)</li> </ul> <p>Depuis GitHub : </p> <pre><code>curl -o librok4-dev.deb https://github.com/rok4/core-cpp/releases/download/2.0.1/librok4-base-2.0.1-ubuntu-20.04-amd64.deb\n# or, with ceph driver\ncurl -o librok4-dev.deb https://github.com/rok4/core-cpp/releases/download/2.0.1/librok4-ceph-2.0.1-ubuntu-20.04-amd64.deb\n\napt install ./librok4-dev.deb\n</code></pre>"},{"location":"#utiliser-la-librairie","title":"Utiliser la librairie","text":""},{"location":"#variables-denvironnement-utilisees","title":"Variables d'environnement utilis\u00e9es","text":"<p>Leur d\u00e9finition est contr\u00f4l\u00e9e \u00e0 l'usage.</p> <ul> <li>Pour le chargement de la configuration (non obligatoire, possibilit\u00e9 de surcharger via des appels)<ul> <li><code>ROK4_TMS_DIRECTORY</code> : dossier (fichier ou objet) contenant les TMS. Le TMS <code>PM</code> sera charg\u00e9 depuis le fichier/objet <code>&lt;ROK4_TMS_DIRECTORY&gt;/PM.json</code></li> <li><code>ROK4_TMS_NO_CACHE</code> : ne pas utiliser le syst\u00e8me de cache pour le chargement des TMS (on recharge le TMS depuis le fichier / objet \u00e0 chaque chargement de couche). Toute valeur d\u00e9sactivera le cache</li> <li><code>ROK4_STYLES_DIRECTORY</code> : dossier (fichier ou objet) contenant les styles. Le style <code>normal</code> sera charg\u00e9 depuis le fichier/objet <code>&lt;ROK4_STYLES_DIRECTORY&gt;/normal.json</code></li> <li><code>ROK4_STYLES_NO_CACHE</code> : ne pas utiliser le syst\u00e8me de cache pour le chargement des styles (on recharge le style depuis le fichier / objet \u00e0 chaque chargement de couche). Toute valeur d\u00e9sactivera le cache.</li> </ul> </li> <li>Pour le stockage objet (non obligatoire, possibilit\u00e9 de surcharger via des appels)<ul> <li><code>ROK4_OBJECT_READ_ATTEMPTS</code> : nombre de tentatives pour les lectures</li> <li><code>ROK4_OBJECT_WRITE_ATTEMPTS</code> : nombre de tentatives pour les \u00e9critures</li> <li><code>ROK4_OBJECT_ATTEMPTS_WAIT</code> : temps d'attente en secondes entre les tentatives</li> </ul> </li> <li>Pour le stockage S3<ul> <li><code>ROK4_S3_URL</code></li> <li><code>ROK4_S3_KEY</code></li> <li><code>ROK4_S3_SECRETKEY</code></li> </ul> </li> <li>Pour le stockage SWIFT<ul> <li><code>ROK4_SWIFT_AUTHURL</code></li> <li><code>ROK4_SWIFT_USER</code></li> <li><code>ROK4_SWIFT_PASSWD</code></li> <li><code>ROK4_SWIFT_PUBLICURL</code></li> <li>Si authentification via Swift<ul> <li><code>ROK4_SWIFT_ACCOUNT</code></li> </ul> </li> <li>Si connection via keystone (pr\u00e9sence de <code>ROK4_KEYSTONE_DOMAINID</code>)<ul> <li><code>ROK4_KEYSTONE_DOMAINID</code></li> <li><code>ROK4_KEYSTONE_PROJECTID</code></li> </ul> </li> <li><code>ROK4_SWIFT_TOKEN_FILE</code> afin de sauvegarder le token d'acc\u00e8s, et ne pas le demander si ce fichier en contient un</li> </ul> </li> <li>Pour configurer l'usage de libcurl (int\u00e9raction SWIFT et S3)<ul> <li><code>ROK4_SSL_NO_VERIFY</code></li> <li><code>HTTP_PROXY</code></li> <li><code>HTTPS_PROXY</code></li> <li><code>NO_PROXY</code></li> </ul> </li> <li>Pour le stockage CEPH<ul> <li><code>ROK4_CEPH_CONFFILE</code></li> <li><code>ROK4_CEPH_USERNAME</code></li> <li><code>ROK4_CEPH_CLUSTERNAME</code></li> </ul> </li> </ul>"},{"location":"#hello-rok4","title":"Hello ROK4 !","text":"<p>Aucune variable d'environnement requise dans cet exemple.</p> <p>Le programme qui suit charge une pyramide SCAN1000 \u00e0 partir de son descripteur, et calcule une image reprojet\u00e9e en 4326.</p> <pre><code>#include &lt;boost/log/trivial.hpp&gt;\n#include &lt;rok4/utils/Pyramid.h&gt;\n#include &lt;rok4/image/file/FileImage.h&gt;\n#include \"rok4/utils/Cache.h\"\n\nint main( int argc, char *argv[] ) {\n\n    BOOST_LOG_TRIVIAL(info) &lt;&lt; \"Hello ROK4 !\";\n\n    Pyramid* p = new Pyramid(\"/path/to/SCAN1000.json\");\n    int error = 0;\n    CRS* crs_dst = CrsBook-&gt;get_crs(\"EPSG:4326\");\n    Image* img = p-&gt;getbbox(\n        10, 10, BoundingBox&lt;double&gt;(5., 45., 6., 46.), 200, 200, crs_dst, \n        false, Interpolation::KernelType::LANCZOS_3, 0, error\n    );\n\n    FileImage* output = FileImage::create_to_write(\n        \"hello.tif\", img-&gt;getBbox(), img-&gt;getResX(), img-&gt;getResY(), img-&gt;getWidth(), img-&gt;getHeight(),\n        p-&gt;getChannels(), p-&gt;getSampleFormat(), p-&gt;getPhotometric(), Compression::eCompression::DEFLATE\n    );\n\n    if (output == NULL) {\n        return 1;\n    }\n\n    if (output-&gt;writeImage(img) &lt; 0) {\n        return 1;\n    }\n\n    // Clean\n\n    delete p;\n    delete img;\n    delete output;\n\n    TmsBook::send_to_trash();\n    TmsBook::empty_trash();\n\n    CrsBook::clean_crss();\n    ProjPool::clean_projs();\n    proj_cleanup();\n\n    IndexCache::clean_indexes();\n    StoragePool::clean_storages();\n\n    return 0;\n}\n</code></pre> <p>La phase de nettoyage est longue car les lectures et reprojection passent par des annuaires d'entit\u00e9 (TMS, stockage, contextes PROJ) pour limiter la cr\u00e9ation d'objets et l'empreinte m\u00e9moire (orient\u00e9 performance pour un serveur). Il faut alors les vider \u00e0 la fin pour \u00e9viter les fuites m\u00e9moires.</p> <p>Commande de compilation</p> <pre><code>g++ \\\n  -DBOOST_LOG_DYN_LINK \\\n  -std=c++11 \\\n  -Wall \\\n  main.cpp \\\n  -lboost_log_setup \\\n  -lboost_log \\\n  -lrok4 \\\n  -lproj \\\n  -pthread \\\n  -o hellorok4\n</code></pre> <p>Appel :</p> <pre><code>~ $ ./hellorok4\n~ $ tiffinfo hello.tif \nTIFF Directory at offset 0x1c626 (116262)\n  Image Width: 200 Image Length: 200\n  Bits/Sample: 8\n  Sample Format: unsigned integer\n  Compression Scheme: AdobeDeflate\n  Photometric Interpretation: RGB color\n  Samples/Pixel: 3\n  Rows/Strip: 16\n  Planar Configuration: single image plane\n</code></pre>"},{"location":"#dans-un-projet-cmake","title":"Dans un projet CMake","text":"<p>Fichier CMake <code>FindRok4.cmake</code></p> <pre><code># If it's found it sets ROK4_FOUND to TRUE\n# and following variables are set:\n#    ROK4_INCLUDE_DIR\n#    ROK4_LIBRARY\n\nFIND_PATH(ROK4_INCLUDE_DIR enums/Format.h \n    /usr/local/include/rok4\n    /usr/include/rok4\n    c:/msys/local/include/rok4\n    )\n\nFIND_LIBRARY(ROK4_LIBRARY NAMES librok4.so PATHS\n    /usr/lib/x86_64-linux-gnu/\n    /usr/local/lib \n    /usr/lib\n    /usr/lib64\n    c:/msys/local/lib\n    )\n\n\nINCLUDE( \"FindPackageHandleStandardArgs\" )\nFIND_PACKAGE_HANDLE_STANDARD_ARGS( \"Rok4\" DEFAULT_MSG ROK4_INCLUDE_DIR ROK4_LIBRARY )\n</code></pre>"},{"location":"#compiler-la-librairie-debian","title":"Compiler la librairie (Debian)","text":""},{"location":"#dependances-supplementaires","title":"D\u00e9pendances suppl\u00e9mentaires","text":"<ul> <li><code>build-essential</code></li> <li><code>cmake</code></li> <li>Pour les tests unitaires<ul> <li><code>libcppunit-dev</code></li> </ul> </li> <li>Pour la documentation<ul> <li><code>doxygen</code></li> <li><code>graphviz</code></li> </ul> </li> </ul> <p><code>apt install build-essential cmake libcppunit-dev doxygen graphviz</code> </p>"},{"location":"#variables-cmake","title":"Variables CMake","text":"<ul> <li><code>CEPH_ENABLED</code> : active la compilation la classe de gestion du stockage Ceph. Valeur par d\u00e9faut : <code>0</code>, <code>1</code> pour activer.</li> <li><code>UNITTEST_ENABLED</code> : active la compilation des tests unitaires. Valeur par d\u00e9faut : <code>1</code>, <code>0</code> pour d\u00e9sactiver.</li> <li><code>DOC_ENABLED</code> : active la compilation de la documentation. Valeur par d\u00e9faut : <code>1</code>, <code>0</code> pour d\u00e9sactiver.</li> <li><code>BUILD_VERSION</code> : version de la librairie compil\u00e9e. Valeur par d\u00e9faut : <code>0.0.0</code>. Utile pour la compilation de la documentation.</li> <li><code>DEBUG_BUILD</code> : active la compilation en mode debug. Valeur par d\u00e9faut : <code>0</code>, <code>1</code> pour activer.</li> </ul>"},{"location":"#compilation-tests-unitaires-et-documentation-et-installation","title":"Compilation, tests unitaires et documentation et installation","text":"<pre><code>mkdir build &amp;&amp; cd build\ncmake -DBUILD_VERSION=0.0.0 -DCMAKE_INSTALL_PREFIX=/opt/rok4 -DCEPH_ENABLED=1 ..\nmake\nmake test\nmake doc\nmake install\n</code></pre>"},{"location":"#contribuer","title":"Contribuer","text":"<p>Consulter les directives de contribution</p>"},{"location":"CHANGELOG/","title":"Historique des versions","text":""},{"location":"CHANGELOG/#201","title":"2.0.1","text":""},{"location":"CHANGELOG/#added","title":"[Added]","text":"<ul> <li><code>Keyword</code> : ajout d'un exporteur JSON (API Tiles)</li> <li><code>TileMatrixLimits</code> : ajout d'un exporteur JSON (API Tiles)</li> </ul>"},{"location":"CHANGELOG/#200","title":"2.0.0","text":""},{"location":"CHANGELOG/#added_1","title":"[Added]","text":"<ul> <li>Internalisation de la lib json</li> <li>Ajout d'exporteur XML (via la lib boost) pour les entit\u00e9s Style, BoundingBox, Keyword, LegendURL, TileMatrixLimit et Style</li> <li>Cr\u00e9ation d'un annuaire pour les CRS pour \u00e9viter les cr\u00e9ations en double</li> </ul>"},{"location":"CHANGELOG/#changed","title":"[Changed]","text":"<ul> <li>Passage complet en snake case</li> <li>Le format de canal contient le nombre de bits d'encodage</li> <li>Renommage StyledImage -&gt; PaletteImage</li> <li>Renommage lzwEncoder -&gt; LzwCompressor</li> <li>Renommage lzwDecoder -&gt; LzwUncompressor</li> <li>Renommage pkbEncoder -&gt; PkbCompressor</li> <li>Renommage pkbDecoder -&gt; PkbUncompressor</li> </ul>"},{"location":"CHANGELOG/#deprecated","title":"[Deprecated]","text":"<p>Liste de fonctionnalit\u00e9s d\u00e9pr\u00e9ci\u00e9es.</p>"},{"location":"CHANGELOG/#removed","title":"[Removed]","text":"<ul> <li>Suppression de la notion 'inspire' dans la gestion des styles</li> <li>Suppression de la classe ConvertedChannelsImage</li> <li>Suppression de la gestion de la compilation avec la librairie Kakadu</li> <li>Suppression des factory pour les classes filles de Image</li> <li>Suppression de la fonctionnalit\u00e9 de crop dans Rok4Image</li> </ul>"},{"location":"CHANGELOG/#fixed","title":"[Fixed]","text":"<ul> <li>Correction du nettoyage des annuaires de TMS et styles</li> </ul>"},{"location":"CHANGELOG/#140","title":"1.4.0","text":""},{"location":"CHANGELOG/#added_2","title":"[Added]","text":"<ul> <li>Stockage objet (S3, Swift et Ceph) <ul> <li>Possibilit\u00e9 de d\u00e9finir un nombre de tentatives pour les lectures (1 par d\u00e9faut) : variable d'environnement <code>ROK4_OBJECT_READ_ATTEMPTS</code> </li> <li>Possibilit\u00e9 de d\u00e9finir un nombre de tentatives pour les \u00e9critures (1 par d\u00e9faut) : variable d'environnement <code>ROK4_OBJECT_WRITE_ATTEMPTS</code> </li> <li>Possibilit\u00e9 de d\u00e9finir un temps d'attente, en secondes, entre les tentatives (5 par d\u00e9faut) : variable d'environnement <code>ROK4_OBJECT_ATTEMPTS_WAIT</code></li> </ul> </li> </ul>"},{"location":"CHANGELOG/#131","title":"1.3.1","text":""},{"location":"CHANGELOG/#fixed_1","title":"[Fixed]","text":"<ul> <li><code>S3Context</code> : pour \u00e9viter des conflits dans une utilisation multithread\u00e9e, la sortie de la fonction HMAC (openssl) est d\u00e9di\u00e9e.</li> </ul>"},{"location":"CHANGELOG/#130","title":"1.3.0","text":""},{"location":"CHANGELOG/#added_3","title":"[Added]","text":"<ul> <li>Gestion du multi cluster S3 :<ul> <li>nom du cluster = h\u00f4te du cluster avec le port (pas de protocole)</li> <li>Pour pr\u00e9ciser le cluster auquel on s'adresse, le nom du bucket aura la forme <code>&lt;nom du bucker&gt;@&lt;nom du cluster&gt;</code></li> <li>Les variables d'environnement <code>ROK4_S3_URL</code>, <code>ROK4_S3_KEY</code> et <code>ROK4_S3_SECRETKEY</code> peuvent contenir une liste de valeurs s\u00e9par\u00e9es par des virgules</li> <li>Dans les descripteurs de pyramide et leur liste ou les objets symboliques, on peut ne pas pr\u00e9ciser le nom du cluster : on sait alors qu'on travaille sur le m\u00eame cluster que celui de l'objet d'origine</li> </ul> </li> </ul>"},{"location":"CHANGELOG/#fixed_2","title":"[Fixed]","text":"<ul> <li>Attribute : dans les valeurs des attributs, on \u00e9chappe les \u00e9ventuelles back quotes</li> </ul>"},{"location":"CHANGELOG/#124","title":"1.2.4","text":""},{"location":"CHANGELOG/#fixed_3","title":"[Fixed]","text":"<ul> <li><code>Cache</code> : les modifications dans le cache quand il n'est pas par thread (index des dalles, TMS et styles) se font en exclusion mutuelle (mutex lock et unlock)</li> </ul>"},{"location":"CHANGELOG/#123","title":"1.2.3","text":""},{"location":"CHANGELOG/#fixed_4","title":"[Fixed]","text":"<ul> <li><code>Level</code> : Ajout de pixels de marge lors de la reprojection des donn\u00e9es d'un niveau de pyramide</li> </ul>"},{"location":"CHANGELOG/#122","title":"1.2.2","text":""},{"location":"CHANGELOG/#fixed_5","title":"[Fixed]","text":"<ul> <li><code>LibopenjpegImage</code> : la lecture des images JPEG 2000 tuil\u00e9es recharge l'image \u00e0 la lecture de chaque tuile</li> </ul>"},{"location":"CHANGELOG/#121","title":"1.2.1","text":""},{"location":"CHANGELOG/#fixed_6","title":"[Fixed]","text":"<ul> <li><code>LegendURL</code> : la fonction de copie d'une instance recopie bien le format et le href</li> <li><code>LibtiffImage</code> : correction du calcul de nombre de tuile dans la largeur lors de la lecture d'une image dont la largeur est un multiple de la taille de la tuile </li> <li><code>BoundingBox</code> : lorsque l'on met en phase une bbox, les 4 bords doivent \u00eatre trait\u00e9s ind\u00e9pendemment les uns des autres (avec un calcul de phase pour chacun)</li> </ul>"},{"location":"CHANGELOG/#changed_1","title":"[Changed]","text":"<ul> <li>La variable d'environnement <code>ROK4_TMS_NO_CACHE</code> permet de d\u00e9sactiver le cache de chargement des TMS</li> <li>La variable d'environnement <code>ROK4_STYLES_NO_CACHE</code> permet de d\u00e9sactiver le cache de chargement des styles</li> </ul>"},{"location":"CHANGELOG/#112","title":"1.1.2","text":""},{"location":"CHANGELOG/#changed_2","title":"[Changed]","text":"<ul> <li>Le test d'existence d'un objet ou d'un fichier n'est plus une lecture de 1 octet mais une impl\u00e9mentation sp\u00e9cifique \u00e0 chaque type</li> <li>Les TMS et les styles sont cherch\u00e9s sur le stockage avec et sans extension JSON</li> </ul>"},{"location":"CHANGELOG/#fixed_7","title":"[Fixed]","text":"<ul> <li>Table<ul> <li>Correction d'une typo dans l'\u00e9criture du metadata.json : filedsCount -&gt; fieldsCount</li> </ul> </li> <li>Style<ul> <li>La valeur de nodata en sortie d'un style est la premi\u00e8re valeur de la palette (et non la couleur pour la valeur 0)</li> </ul> </li> </ul>"},{"location":"CHANGELOG/#111","title":"1.1.1","text":""},{"location":"CHANGELOG/#fixed_8","title":"[Fixed]","text":"<ul> <li>LibopenjpegImage<ul> <li>Fixe sur la lecture des images \u00e0 tuile unique suite au zonage</li> </ul> </li> </ul>"},{"location":"CHANGELOG/#110","title":"1.1.0","text":""},{"location":"CHANGELOG/#added_4","title":"[Added]","text":"<ul> <li>LibtiffImage<ul> <li>Capacit\u00e9 \u00e0 lire des images tuil\u00e9es</li> <li>Capacit\u00e9 \u00e0 lire des images avec palette</li> </ul> </li> </ul>"},{"location":"CHANGELOG/#changed_3","title":"[Changed]","text":"<ul> <li>LibopenjpegImage<ul> <li>Lecture des images \u00e0 tuile unique par paquet de 256 lignes</li> <li>Lecture des images tuil\u00e9es par tuile</li> </ul> </li> </ul>"},{"location":"CHANGELOG/#103","title":"1.0.3","text":"<p>Les librairies sont g\u00e9r\u00e9es de mani\u00e8re ind\u00e9pendantes, conditionn\u00e9es pour \u00eatre install\u00e9es en tant que d\u00e9pendance dynamique. Le projet a son propre site, avec toutes les versions et leur documentation.</p>"},{"location":"CHANGELOG/#added_5","title":"[Added]","text":"<ul> <li>Librairie, partie <code>utils</code> :<ul> <li>Styles et TMS sont charg\u00e9s dans un annuaire, qui connait le dossier de stockage des fichiers / objets les d\u00e9finissant</li> <li>Les pyramide sont charg\u00e9es depuis leur descripteur, fichier ou objet</li> </ul> </li> <li>Librairie, partie <code>storage</code> : g\u00e8re un annuaire de contextes de stockages, fichier, Swift, S3 ou Ceph</li> <li>Librairie, partie <code>image</code> : permet la lecture et le calcul ligne par ligne</li> <li>Librairie, partie <code>datasource</code> : permet la lecture en une fois d'un buffer de donn\u00e9e</li> <li>Librairie, partie <code>datasource</code> : permet la lecture par morceau d'un buffer de donn\u00e9e</li> <li> <p>Librairie, partie <code>processors</code> : g\u00e8re plusieurs noyaux d'interpolation et la conversion de pixel</p> </li> <li> <p>Int\u00e9gration continue :</p> <ul> <li>Compilation du fichier librok4.so et conditionnement dans des paquets debian avec les headers, avec et sans la prise en charge du stockage ceph</li> <li>Jeu des tests unitaires</li> <li>Compilation de la documentation et publication sur la branche gh-pages</li> </ul> </li> <li> <p>Ajout du mode DEBUG \u00e0 la compilation</p> </li> </ul>"},{"location":"CONTRIBUTING/","title":"Directives de contribution","text":"<p>Merci d'envisager de contribuer \u00e0 ce projet !</p>"},{"location":"CONTRIBUTING/#pull-request","title":"Pull request","text":"<p>Le titre de la PR est utilis\u00e9 pour constituer automatiquement les notes de release. Vous pouvez pr\u00e9ciser en commentaire de votre PR des d\u00e9tails qui seront ajout\u00e9s dans le fichier <code>CHANGELOG.md</code> par les mainteneurs du projet.</p> <p>Le formalisme du changelog est le suivant, en markdown :</p> <pre><code>### [Added]\n\nListe de nouvelles fonctionnalit\u00e9s.\n\n### [Changed]\n\nListe de fonctionnalit\u00e9s existantes modifi\u00e9es.\n\n### [Deprecated]\n\nListe de fonctionnalit\u00e9s d\u00e9pr\u00e9ci\u00e9es.\n\n### [Removed]\n\nListe de foncitonnalit\u00e9s retir\u00e9es.\n\n### [Fixed]\n\nListe de corrections fonctionnelles.\n\n### [Security]\n\nListe de corrections de s\u00e9curit\u00e9.\n</code></pre> <p>Les parties vides, sans \u00e9l\u00e9ment \u00e0 lister, peuvent \u00eatre ignor\u00e9es.</p>"},{"location":"documentation/","title":"Documentation technique","text":""}]}